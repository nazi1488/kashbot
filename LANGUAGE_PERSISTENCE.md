# üåê –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

## üìã –û–±–∑–æ—Ä —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ **–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —è–∑—ã–∫–∞** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –¢–µ–ø–µ—Ä—å:

- ‚úÖ **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ `/start`** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —è–∑—ã–∫
- ‚úÖ **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ `/start`** - —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- ‚úÖ **–Ø–∑—ã–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–≤—Å–µ–≥–¥–∞
- ‚úÖ **–ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞** —è–∑—ã–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥–µ

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### **–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã `/start`:**

#### **–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
```
/start ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î ‚Üí –Ø–∑—ã–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –í—ã–±–æ—Ä —è–∑—ã–∫–∞ ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î ‚Üí –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
```

#### **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
```
/start ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î ‚Üí –Ø–∑—ã–∫ –Ω–∞–π–¥–µ–Ω ‚Üí –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —è–∑—ã–∫–∞ ‚Üí –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Üí –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
```

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### **1. üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**

#### **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ –≤ —Ç–∞–±–ª–∏—Ü—É `users`:**
```sql
ALTER TABLE users ADD COLUMN language VARCHAR(5) DEFAULT NULL;
```

#### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:**
- `id` - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `tg_id` - Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
- `username` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **`language` - –∫–æ–¥ —è–∑—ã–∫–∞ (ru, en, uk)** ‚ú® **–ù–û–í–û–ï**
- `first_seen_at` - –¥–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è
- `last_seen_at` - –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è
- `is_blocked` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ –±–æ—Ç

### **2. üîß –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ `Database`:**

#### **–ü–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```python
async def get_user_language(self, tg_id: int) -> str:
    """–ü–æ–ª—É—á–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —è–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    query = "SELECT language FROM users WHERE tg_id = %s"
    result = await self.execute(query, (tg_id,), fetch=True)
    return result[0]['language'] if result and result[0]['language'] else None
```

#### **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```python
async def set_user_language(self, tg_id: int, language: str, username: str = None) -> bool:
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —è–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–æ–∑–¥–∞–µ—Ç –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)"""
    # UPDATE —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∏–ª–∏ INSERT –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    # —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ON CONFLICT –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
```

### **3. üì± –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `/start`:**

#### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞:**
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —è–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
saved_language = None
if 'database' in context.bot_data:
    db = context.bot_data['database']
    saved_language = await db.get_user_language(user.id)

if saved_language:
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —è–∑—ã–∫ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –º–µ–Ω—é
    context.user_data['language'] = saved_language
    await update.message.reply_text(get_text(context, 'welcome_back'))
    # ‚Üí –°—Ä–∞–∑—É –∫ –≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—é
else:
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —è–∑—ã–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    # ‚Üí –í—ã–±–æ—Ä —è–∑—ã–∫–∞ ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Üí –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
```

#### **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞:**
```python
async def language_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    lang_code = query.data.split('_')[1]
    user = query.from_user
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ session
    context.user_data['language'] = lang_code
    
    # üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    if 'database' in context.bot_data:
        db = context.bot_data['database']
        await db.set_user_language(user.id, lang_code, user.username)
```

---

## üéØ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

### **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞:**
1. `/start` 
2. "–û–±–µ—Ä—ñ—Ç—å –º–æ–≤—É / Choose language / –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫"
3. [üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞] [üá∑üá∫ –†—É—Å—Å–∫–∏–π] [üá¨üáß English]
4. **–ö–ª–∏–∫ –Ω–∞ —è–∑—ã–∫** ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
5. "‚úÖ –Ø–∑—ã–∫ –≤—ã–±—Ä–∞–Ω!"
6. –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—é

### **–í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏:**
1. `/start`
2. "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ!" *(–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ)*
3. **–°—Ä–∞–∑—É –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é** - –±–µ–∑ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞! üöÄ

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ:**
```
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —è–∑—ã–∫–∞: —É—Å–ø–µ—à–Ω–æ
‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞: en ‚Üí en —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç  
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞: en ‚Üí ru –∏–∑–º–µ–Ω–∏–ª—Å—è
‚úÖ –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ None
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î: –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
‚úÖ –†–∞–∑–Ω—ã–µ —è–∑—ã–∫–∏: ru, en, uk, de, fr - –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç
```

### **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
```sql
-- –ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
tg_id: 1171754293
username: officer_baza  
language: ru
first_seen_at: 2025-09-24 03:18:06
last_seen_at: 2025-09-24 03:18:06
```

---

## üåç –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏

### **–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏:**

#### **`welcome_back`:**
- üá∑üá∫ **–†—É—Å—Å–∫–∏–π**: "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ!"
- üá¨üáß **English**: "üëã Welcome back!"  
- üá∫üá¶ **–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞**: "üëã –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –Ω–∞–∑–∞–¥!"

### **–í—Å–µ —è–∑—ã–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:**
- `ru` - –†—É—Å—Å–∫–∏–π
- `en` - English
- `uk` - –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞
- *+ –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ –∫–æ–¥—ã —è–∑—ã–∫–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏*

---

## üîß –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### **–í—ã–ø–æ–ª–Ω–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è:**
```bash
python3 migration_add_language.py

üîß –ú–ò–ì–†–ê–¶–ò–Ø: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è language –≤ —Ç–∞–±–ª–∏—Ü—É users
‚úÖ –ö–æ–ª–æ–Ω–∫–∞ language —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞
üéâ –ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!
```

### **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- ‚úÖ **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** - –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º `/start` –≤—ã–±–µ—Ä—É—Ç —è–∑—ã–∫
- ‚úÖ **–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** - —Å—Ä–∞–∑—É –≤—ã–±–µ—Ä—É—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç —è–∑—ã–∫
- ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —è–∑—ã–∫–∞

---

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- üéØ **–£–¥–æ–±—Å—Ç–≤–æ** - –Ω–µ –Ω—É–∂–Ω–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –≤—ã–±–∏—Ä–∞—Ç—å —è–∑—ã–∫
- ‚ö° **–°–∫–æ—Ä–æ—Å—Ç—å** - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—é  
- üåê **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—Å–µ–≥–¥–∞ –Ω–∞ –Ω—É–∂–Ω–æ–º —è–∑—ã–∫–µ

### **–î–ª—è —Å–∏—Å—Ç–µ–º—ã:**
- üíæ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** - —è–∑—ã–∫ —Ö—Ä–∞–Ω–∏—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** - –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ —è–∑—ã–∫ –æ—Å—Ç–∞–µ—Ç—Å—è
- üìä **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –º–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —è–∑—ã–∫–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üõ†Ô∏è **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–°–∏—Å—Ç–µ–º–∞ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è —è–∑—ã–∫–∞ –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞:**

### ‚úÖ **–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- **–ü–µ—Ä–≤—ã–π `/start`** - –≤—ã–±–æ—Ä —è–∑—ã–∫–∞ ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- **–ü–æ–≤—Ç–æ—Ä–Ω—ã–π `/start`** - **—Å—Ä–∞–∑—É –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é** –±–µ–∑ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –Ω–æ–≤–æ–µ –ø–æ–ª–µ `language` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- **–ú–µ—Ç–æ–¥—ã –ë–î** - `get_user_language()` –∏ `set_user_language()`
- **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ `welcome_back`

### üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ **–±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç** –≤—ã–±–∏—Ä–∞—Ç—å —è–∑—ã–∫ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥–µ `/start`. 

**–û–¥–∏–Ω —Ä–∞–∑ –≤—ã–±—Ä–∞–ª ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å –Ω–∞–≤—Å–µ–≥–¥–∞! üåê**

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
