# üé¨ –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è Instagram Reels

## üìã –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–π URL
```
https://www.instagram.com/reel/DIW0MCUyddx/?igsh=MWViemI3bTB5NWp0Zg==
```

## ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —ç—Ç–∞–ø—ã

### 1. **URL –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è**
- ‚úÖ URL –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ Tracking –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`igsh=`) –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–¥–∞–ª—è—é—Ç—Å—è
- ‚úÖ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ `instagram`

### 2. **–°–∏—Å—Ç–µ–º–∞ –∫—É–∫–æ–≤**
- ‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã –∫—É–∫–∏ (ID=6, 19 –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–æ—Ç–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 3/3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—É–∫–æ–≤

### 3. **–ó–∞–≥—Ä—É–∑–∫–∞**
- ‚úÖ yt-dlp —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ
- ‚úÖ –†–∞–∑–º–µ—Ä: 451 KB (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –¥–ª—è Telegram)
- ‚úÖ –§–æ—Ä–º–∞—Ç: MP4 (—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π)
- ‚úÖ –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: ~1 —Å–µ–∫—É–Ω–¥–∞

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞** (–ò–°–ü–†–ê–í–õ–ï–ù–ê)
```
'VideoDownloader' object has no attribute 'max_file_size'
```
**–ü—Ä–∏—á–∏–Ω–∞:** –í –Ω–æ–≤–æ–º –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `self.max_file_size` –≤–º–µ—Å—Ç–æ `self.config.max_file_size`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–∞ `self.config.max_file_size`

---

## üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. **üü° –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ User-Agent –≤ –∫—É–∫–∞—Ö**
**–ü—Ä–æ–±–ª–µ–º–∞:** –£ –∫—É–∫–æ–≤ –Ω–µ—Ç User-Agent, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø–æ–¥–æ–∑—Ä–µ–Ω–∏—è Instagram

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –í cookies_manager.py –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫—É–∫–æ–≤
async def add_cookies(self, platform: str, cookies_data: str, 
                     user_agent: Optional[str] = None):
    if not user_agent and platform == 'instagram':
        user_agent = "Instagram 219.0.0.12.117 Android ..."
```

### 2. **üü° –ù–µ–ø–æ–ª–Ω—ã–µ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π User-Agent

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ `download_config.py`:
```python
'instagram': {
    'headers': {
        'User-Agent': 'Instagram 219.0.0.12.117 Android...',
        'Accept': '*/*',
        'Accept-Language': 'en-US,en;q=0.5',
        'Accept-Encoding': 'gzip, deflate, br',
        'X-IG-App-ID': '936619743392459',
        'X-IG-WWW-Claim': '0',
        'Origin': 'https://www.instagram.com',
        'Sec-Fetch-Dest': 'empty',
        'Sec-Fetch-Mode': 'cors',
        'Sec-Fetch-Site': 'same-origin'
    }
}
```

### 3. **üü° –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fallback –º–µ—Ç–æ–¥–æ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å fallback —Ü–µ–ø–æ—á–∫—É:
```python
async def download_with_fallback(self, url: str):
    methods = [
        self._try_with_cookies,
        self._try_without_cookies, 
        self._try_alternative_extractor,
        self._try_web_scraping
    ]
    
    for method in methods:
        try:
            result = await method(url)
            if result: return result
        except: continue
    
    return None, "–í—Å–µ –º–µ—Ç–æ–¥—ã –Ω–µ —É–¥–∞–ª–∏—Å—å"
```

### 4. **üü° –ù–µ—Ç –¥–µ—Ç–µ–∫—Ü–∏–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```python
def is_private_account(self, url: str) -> bool:
    # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ URL –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º
    # –∏–ª–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π HEAD –∑–∞–ø—Ä–æ—Å
    pass
```

### 5. **üü† –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ–¥–Ω–æ–≥–æ URL —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à –Ω–∞ –æ—Å–Ω–æ–≤–µ hash URL:
```python
class VideoCache:
    def __init__(self, ttl_hours=24):
        self.cache = {}
        self.ttl = ttl_hours * 3600
    
    async def get_or_download(self, url: str):
        url_hash = hashlib.md5(url.encode()).hexdigest()
        
        if url_hash in self.cache:
            cache_entry = self.cache[url_hash]
            if time.time() - cache_entry['timestamp'] < self.ttl:
                return cache_entry['path'], None
        
        # –°–∫–∞—á–∏–≤–∞–µ–º –∏ –∫—ç—à–∏—Ä—É–µ–º
        result = await self.download(url)
        if result[0]:  # –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
            self.cache[url_hash] = {
                'path': result[0],
                'timestamp': time.time()
            }
        
        return result
```

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ database/analytics.py
async def track_download_attempt(self, url: str, platform: str, 
                               success: bool, error: str = None):
    query = """
        INSERT INTO download_stats 
        (url_hash, platform, success, error, timestamp)
        VALUES (%s, %s, %s, %s, NOW())
    """
    await self.db.execute(query, (
        hashlib.md5(url.encode()).hexdigest(),
        platform, success, error
    ))
```

### 2. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
```python
class InstagramError:
    ERROR_TYPES = {
        'login_required': '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è',
        'private_account': '–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç', 
        'content_deleted': '–ö–æ–Ω—Ç–µ–Ω—Ç —É–¥–∞–ª–µ–Ω',
        'geo_blocked': '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –≤ —Ä–µ–≥–∏–æ–Ω–µ',
        'rate_limited': '–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤'
    }
    
    @classmethod
    def parse_error(cls, error_msg: str) -> str:
        # –£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ yt-dlp
        pass
```

### 3. **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞–≥—Ä—É–∑–∫–∏**
```python
class AdaptiveDownloader:
    def __init__(self):
        self.success_rates = {}  # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–µ—Ç–æ–¥–∞–º
        
    async def choose_best_method(self, platform: str):
        # –í—ã–±–∏—Ä–∞–µ–º –º–µ—Ç–æ–¥ —Å –ª—É—á—à–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
        methods = sorted(
            self.methods[platform],
            key=lambda m: self.success_rates.get(m.name, 0),
            reverse=True
        )
        return methods[0]
```

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### üî¥ **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**
1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ max_file_size** 
2. üî≤ **–î–æ–±–∞–≤–∏—Ç—å User-Agent –≤ –∫—É–∫–∏**
3. üî≤ **–£–ª—É—á—à–∏—Ç—å HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏**

### üü° **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**  
4. üî≤ **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å fallback –º–µ—Ç–æ–¥—ã**
5. üî≤ **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
6. üî≤ **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**

### üü¢ **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**
7. üî≤ **–î–µ—Ç–µ–∫—Ü–∏—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤**
8. üî≤ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
9. üî≤ **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ **–£—Å–ø–µ—à–Ω–æ:**
- URL –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ö—É–∫–∏ –ø–æ–ª—É—á–µ–Ω—ã –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã  
- –í–∏–¥–µ–æ —Å–∫–∞—á–∞–Ω–æ (451 KB, MP4)
- –§–∞–π–ª –≥–æ—Ç–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram

### üéâ **–í—ã–≤–æ–¥:**
–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ Instagram. –û—Å–Ω–æ–≤–Ω–∞—è –æ—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞. –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–º–æ–≥—É—Ç –ø–æ–≤—ã—Å–∏—Ç—å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –ø–æ–∫—Ä—ã—Ç–∏–µ edge cases.
