#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–∫–∞–∑–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è "–ø–æ–≤—Ç–æ—Ä–∏—Ç—å" –≤ –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä–µ
"""

import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent))

def test_compressor_timing_fix():
    """–ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è"""
    
    print("üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è '–ø–æ–≤—Ç–æ—Ä–∏—Ç—å'")
    print("=" * 60)
    
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
        from handlers.compressor import wrong_media_handler_compress, compress_file_handler, process_compression_task
        print("‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è")
        
        # –ß–∏—Ç–∞–µ–º –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        import inspect
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º wrong_media_handler_compress
        handler_code = inspect.getsource(wrong_media_handler_compress)
        if 'compress_more_or_menu' not in handler_code:
            print("‚úÖ wrong_media_handler_compress –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å")
        else:
            print("‚ùå wrong_media_handler_compress –≤—Å–µ –µ—â–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å")
            return False
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º compress_file_handler
        file_handler_code = inspect.getsource(compress_file_handler)
        if 'compress_more_or_menu' not in file_handler_code:
            print("‚úÖ compress_file_handler –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å")
        else:
            print("‚ùå compress_file_handler –≤—Å–µ –µ—â–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å")
            return False
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º process_compression_task
        task_code = inspect.getsource(process_compression_task)
        if 'compress_more_or_menu' in task_code:
            print("‚úÖ process_compression_task –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ—Å–ª–µ —Å–∂–∞—Ç–∏—è")
        else:
            print("‚ùå process_compression_task –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å")
            return False
        
        print("\nüìã –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:")
        print("   1. ‚úÖ –£–±—Ä–∞–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–∑ wrong_media_handler_compress")
        print("   2. ‚úÖ –£–±—Ä–∞–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–∑ compress_file_handler") 
        print("   3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤ process_compression_task")
        
        print("\n‚è±Ô∏è –ù–æ–≤–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:")
        print("   1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∏–¥–µ–æ")
        print("   2. –ë–æ—Ç: '–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ –∫ —Å–∂–∞—Ç–∏—é! –°–æ–≤–µ—Ç...'")
        print("   3. –ë–æ—Ç: '–í–∞—à —Ñ–∞–π–ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å'")
        print("   4. –ë–æ—Ç: '–ü–æ–∑–∏—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏: 1'")
        print("   5. ‚è∞ –û–ñ–ò–î–ê–ù–ò–ï –û–ë–†–ê–ë–û–¢–ö–ò...")
        print("   6. –ë–æ—Ç: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∂–∞—Ç—ã–π —Ñ–∞–π–ª")
        print("   7. –ë–æ—Ç: '–•–æ—Ç–∏—Ç–µ —Å–∂–∞—Ç—å –µ—â–µ —Ñ–∞–π–ª—ã?' ‚Üê –¢–û–õ–¨–ö–û –ó–î–ï–°–¨!")
        
        print("\nüö´ –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞:")
        print("   ‚Ä¢ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å")
        print("   ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª –∫–Ω–æ–ø–∫–∏ –µ—â–µ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∂–∞—Ç–∏—è")
        print("   ‚Ä¢ –°–±–∏–≤–∞–ª–æ —Å —Ç–æ–ª–∫—É - –ø—Ä–æ—Ü–µ—Å—Å –µ—â–µ –Ω–µ –∑–∞–∫–æ–Ω—á–µ–Ω")
        
        print("\n‚úÖ –¢–µ–ø–µ—Ä—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:")
        print("   ‚Ä¢ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Å–∂–∞—Ç–∏—è")
        print("   ‚Ä¢ –õ–æ–≥–∏—á–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π")
        print("   ‚Ä¢ –ù–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—ã —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
        
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {e}")
        import traceback
        traceback.print_exc()
        return False

if __name__ == "__main__":
    success = test_compressor_timing_fix()
    
    if success:
        print("\n" + "=" * 60)
        print("üéâ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è '–ø–æ–≤—Ç–æ—Ä–∏—Ç—å' –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
        print("\nüí° –†–µ–∑—É–ª—å—Ç–∞—Ç:")
        print("   ‚Ä¢ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∂–∞—Ç–∏—è")
        print("   ‚Ä¢ –õ–æ–≥–∏—á–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
        print("   ‚Ä¢ –ù–µ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
    
    sys.exit(0 if success else 1)
