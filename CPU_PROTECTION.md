# –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ CPU

## –ü—Ä–æ–±–ª–µ–º–∞

–§—É–Ω–∫—Ü–∏—è "üìâ –£–º–Ω–æ–µ —Å–∂–∞—Ç–∏–µ –¥–ª—è FB" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ (H.265) –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ CPU. –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç:

- üî• –ü–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–æ 100%
- üíæ –ò—Å—á–µ—Ä–ø–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å
- üêå –ó–∞–º–µ–¥–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤—Å–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- ‚ö†Ô∏è –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–∞–¥–µ–Ω–∏—é –±–æ—Ç–∞

## –†–µ—à–µ–Ω–∏–µ: –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—å—é

### 1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á**
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –º–∞–∫—Å–∏–º—É–º 2 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–∂–∞—Ç–∏—è
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `COMPRESSION_MAX_CONCURRENT`

### 2. **–û—á–µ—Ä–µ–¥—å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º**
- –ú–∞–∫—Å–∏–º—É–º 10 –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- –ü—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è

### 3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≥—Ä—É–∑–∫–∏ CPU**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∑–∞–¥–∞—á–∏
- –ï—Å–ª–∏ CPU > 80%, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏

### 4. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
- –ú–∞–∫—Å–∏–º—É–º 3 –∑–∞–¥–∞—á–∏ –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∞–º –∏ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è

### 5. **–¢–∞–π–º–∞—É—Ç –∑–∞–¥–∞—á**
- 5 –º–∏–Ω—É—Ç –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ–Ω–∞ –∑–∞–≤–∏—Å—à–∏—Ö –∑–∞–¥–∞—á

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–í —Ñ–∞–π–ª–µ `.env`:

```env
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—á–µ—Ä–µ–¥–∏ —Å–∂–∞—Ç–∏—è
COMPRESSION_MAX_CONCURRENT=2     # –ú–∞–∫—Å. –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
COMPRESSION_MAX_QUEUE_SIZE=10    # –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏
COMPRESSION_CPU_THRESHOLD=80.0   # –ü–æ—Ä–æ–≥ –∑–∞–≥—Ä—É–∑–∫–∏ CPU (%)
COMPRESSION_TASK_TIMEOUT=300     # –¢–∞–π–º–∞—É—Ç –∑–∞–¥–∞—á–∏ (—Å–µ–∫—É–Ω–¥—ã)
```

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

**–î–ª—è —Å–ª–∞–±–æ–≥–æ VPS (1-2 CPU):**
```env
COMPRESSION_MAX_CONCURRENT=1
COMPRESSION_CPU_THRESHOLD=70.0
```

**–î–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (4 CPU):**
```env
COMPRESSION_MAX_CONCURRENT=2
COMPRESSION_CPU_THRESHOLD=80.0
```

**–î–ª—è –º–æ—â–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (8+ CPU):**
```env
COMPRESSION_MAX_CONCURRENT=4
COMPRESSION_CPU_THRESHOLD=85.0
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–æ–º–∞–Ω–¥–∞ `/stats` (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π Telegram ID –≤ `.env`:
```env
BOT_ADMINS=123456789
```

–ö–æ–º–∞–Ω–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- üìä –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏
- ‚öôÔ∏è –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
- üíª –¢–µ–∫—É—â—É—é –∑–∞–≥—Ä—É–∑–∫—É CPU
- üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏ —Å–∂–∞—Ç–∏—è

üîÑ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
‚Ä¢ –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏: 3
‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á: 2/2
‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 4

üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
‚Ä¢ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 156
‚Ä¢ –û—à–∏–±–æ–∫: 2

üíª –°–∏—Å—Ç–µ–º–∞:
‚Ä¢ –ó–∞–≥—Ä—É–∑–∫–∞ CPU: 67.3%
‚Ä¢ –ü–æ—Ä–æ–≥ CPU: 80.0%
```

## –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

### –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –æ—á–µ—Ä–µ–¥—å:
```
‚è≥ –í–∞—à —Ñ–∞–π–ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∫–∏

üìä –ü–æ–∑–∏—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏: 3
‚öôÔ∏è –°–µ–π—á–∞—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è: 2/2 —Ñ–∞–π–ª–æ–≤

‚è± –û–∂–∏–¥–∞–π—Ç–µ...
```

### –ü—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ—á–µ—Ä–µ–¥–∏:
```
‚ùå –û—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.

üìä –í –æ—á–µ—Ä–µ–¥–∏: 10 —Ñ–∞–π–ª–æ–≤
```

### –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞:
```
‚ùå –£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å 3 —Ñ–∞–π–ª–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
QueueManager
‚îú‚îÄ‚îÄ Semaphore (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏)
‚îú‚îÄ‚îÄ asyncio.Queue (–æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á)
‚îú‚îÄ‚îÄ CPU Monitor (psutil)
‚îú‚îÄ‚îÄ User Tracking (—Å–ª–æ–≤–∞—Ä—å user_id: count)
‚îî‚îÄ‚îÄ Statistics (—Å—á–µ—Ç—á–∏–∫–∏)
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–° —Å–∏—Å—Ç–µ–º–æ–π –æ—á–µ—Ä–µ–¥–µ–π:
- ‚úÖ CPU –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–æ—Ä–æ–≥
- ‚úÖ –°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∑—ã–≤—á–∏–≤—ã–º
- ‚úÖ –î—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç DDoS —á–µ—Ä–µ–∑ —Å–ø–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:

1. **–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ**: –£–≤–µ–ª–∏—á—å—Ç–µ –º–æ—â–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø–æ–¥–Ω–∏–º–∏—Ç–µ –ª–∏–º–∏—Ç—ã
2. **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ**: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ —Å –æ–±—â–µ–π –æ—á–µ—Ä–µ–¥—å—é (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏)
3. **–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã**: –í—ã–Ω–µ—Å–∏—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
```
INFO - User 123456 added video.mp4 to compression queue, position: 3
INFO - Processing task for user 123456, current tasks: 2/2
WARNING - CPU overloaded: 85.2% > 80.0%
INFO - Task completed for user 123456
```

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install psutil==5.9.8  # –î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ CPU
```

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
